---
metadata:
  id: "CKV_K8S_CUSTOM_019"
  name: "Ensure NetworkPolicy is defined for pod"
  category: "KUBERNETES_NETWORKING"
  severity: "MEDIUM"
  guideline: "NetworkPolicies control traffic flow between pods, implementing network segmentation and reducing attack surface."
definition:
  cond_type: "attribute"
  resource_types:
    - "NetworkPolicy"
  attribute: "spec"
  operator: "exists"

---
metadata:
  id: "CKV_K8S_CUSTOM_020"
  name: "Ensure NetworkPolicy has both ingress and egress rules defined"
  category: "KUBERNETES_NETWORKING"
  severity: "MEDIUM"
  guideline: "Defining both ingress and egress rules provides comprehensive network security control."
definition:
  and:
    - cond_type: "attribute"
      resource_types:
        - "NetworkPolicy"
      attribute: "spec.ingress"
      operator: "exists"
    - cond_type: "attribute"
      resource_types:
        - "NetworkPolicy"
      attribute: "spec.egress"
      operator: "exists"

---
metadata:
  id: "CKV_K8S_CUSTOM_021"
  name: "Ensure hostNetwork is not enabled"
  category: "KUBERNETES_NETWORKING"
  severity: "HIGH"
  guideline: "Using hostNetwork gives the pod access to the host's network namespace, increasing security risks."
definition:
  or:
    - cond_type: "attribute"
      resource_types:
        - "Pod"
        - "Deployment"
        - "StatefulSet"
        - "DaemonSet"
        - "Job"
        - "CronJob"
      attribute: "spec.hostNetwork"
      operator: "not_exists"
    - cond_type: "attribute"
      resource_types:
        - "Pod"
        - "Deployment"
        - "StatefulSet"
        - "DaemonSet"
        - "Job"
        - "CronJob"
      attribute: "spec.hostNetwork"
      operator: "equals"
      value: false

---
metadata:
  id: "CKV_K8S_CUSTOM_022"
  name: "Ensure hostPID is not enabled"
  category: "KUBERNETES_NETWORKING"
  severity: "HIGH"
  guideline: "Enabling hostPID allows the pod to see all processes on the host, which is a security risk."
definition:
  or:
    - cond_type: "attribute"
      resource_types:
        - "Pod"
        - "Deployment"
        - "StatefulSet"
        - "DaemonSet"
        - "Job"
        - "CronJob"
      attribute: "spec.hostPID"
      operator: "not_exists"
    - cond_type: "attribute"
      resource_types:
        - "Pod"
        - "Deployment"
        - "StatefulSet"
        - "DaemonSet"
        - "Job"
        - "CronJob"
      attribute: "spec.hostPID"
      operator: "equals"
      value: false

---
metadata:
  id: "CKV_K8S_CUSTOM_023"
  name: "Ensure hostIPC is not enabled"
  category: "KUBERNETES_NETWORKING"
  severity: "HIGH"
  guideline: "Enabling hostIPC allows the pod to access the host's IPC namespace, creating security vulnerabilities."
definition:
  or:
    - cond_type: "attribute"
      resource_types:
        - "Pod"
        - "Deployment"
        - "StatefulSet"
        - "DaemonSet"
        - "Job"
        - "CronJob"
      attribute: "spec.hostIPC"
      operator: "not_exists"
    - cond_type: "attribute"
      resource_types:
        - "Pod"
        - "Deployment"
        - "StatefulSet"
        - "DaemonSet"
        - "Job"
        - "CronJob"
      attribute: "spec.hostIPC"
      operator: "equals"
      value: false

---
metadata:
  id: "CKV_K8S_CUSTOM_024"
  name: "Ensure Service does not use default namespace"
  category: "KUBERNETES_NETWORKING"
  severity: "LOW"
  guideline: "Using default namespace makes it harder to manage and secure resources. Create dedicated namespaces."
definition:
  and:
    - cond_type: "attribute"
      resource_types:
        - "Service"
      attribute: "metadata.namespace"
      operator: "exists"
    - cond_type: "attribute"
      resource_types:
        - "Service"
      attribute: "metadata.namespace"
      operator: "not_equals"
      value: "default"
